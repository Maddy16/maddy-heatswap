<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="shortcut icon" href="../../assets/ico/favicon.ico">
    <link rel="stylesheet" href="/css/font-awesome.min.css">
            <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
      <script type="text/javascript" src="http://www.parsecdn.com/js/parse-1.2.18.min.js"></script>
      <script src="js/header.js"></script>
      <script type="text/javascript" src="js/photoGeneration.js"></script>

    <title id="pageTitle">Cart</title>

    <!-- Bootstrap core CSS -->
    <link href="css/bootstrap.css" rel="stylesheet">

    <!-- Custom styles -->
    <link href="css/custom.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
        
 <body>
    
    <div class="container">
      
    <div id="logo-navbar" class="row navbar">
        
        <div class="col-xs-12 col-md-4" >
          <a href="index.html"><img alt="logo" class="img-responsive center-block" src="images/logo.png"></a>
        </div>
  
        <div class="col-xs-5 col-md-4 col-md-offset-4 col-lg-4 col-lg-offset-4">
          <ul id="main-nav-social-icons" class="nav navbar-nav">
            <li><a target="_blank" href="https://www.youtube.com/user/HeatSwapTV"><img alt="YouTube" class="img-responsive" src="images/YouTube-social-squircle_red_24px.png"></a></li>
            <li><a target="_blank" href="http://instagram.com/heatswap"><img alt="Instagram" class="img-responsive" src="images/Instagram_Icon_24px.png"></a></li>
          </ul>
        </div>
        <div id="login-menu" class="col-xs-7 col-md-5 col-md-offset-3 col-lg-4 col-lg-offset-4 text-right">    
          <div id="logTest">
          </div>
          <script>
          var holdBrand="";
            Parse.initialize("Ycnw3xJDv5iT8avNOo54rTM0kuTJpNMMwsMs4iIP", "qYnG7XTl8iSLu9M5iP1lZLiC8LBQHYyCvqwuE3e3");
            
            var currentUser = Parse.User.current()
            var currentName=""

            if(currentUser!=null) currentName=currentUser.get("username");
              if(currentName!=null&&currentName!=""){
                var finalObj=""
                finalObj += "<ul class='nav navbar-nav navbar-right'>\n"

                finalObj += "<li class='dropdown'><a href='#' class='dropdown-toggle' data-toggle='dropdown' id='usernameDisplay'>What's up <b id='currentUsername'>"+currentName+"</b>?</a>\n"
                finalObj += "<ul class='dropdown-menu'>\n"
                finalObj += "<li><a href='storePreview.html'>View Store</a></li>\n"
                if(currentUser.get("storeId")!="")
                finalObj += "<li><a href='currentlyListed.html'>Manage Shoes</a></li>"
                finalObj += "<li><a href='settings.html' role='button'>Account Settings</a></li>"
                finalObj += "</ul>\n"

                var alerts=0;
                if(currentUser.get("emailVerified")==false){
                  alerts=alerts+1;
                }

                finalObj += "<li class='dropdown'><a href='#' class='dropdown-toggle' data-toggle='dropdown' id='usernameDisplay'><span class='badge' id='alertsBadge'>" + alerts + "</span>  alerts</a>\n"
                finalObj += "<ul class='dropdown-menu'>\n"
                if(alerts==0){
                  finalObj += "<center style='cursor:default;'>No new alerts!</center>\n"
                }

                if(currentUser.get("emailVerified")==false){
                  finalObj += "<center style='cursor:default;'>Please verify your email</center>\n"
                }

                finalObj += "</ul>\n"

                finalObj += "<li onClick='logOut()'><a href='#accountModal' role='button' data-toggle='modal'><span class='glyphicon glyphicon-lock'></span> log out</a></li>\n"

                finalObj += "</li>\n"
                finalObj += "</ul>\n"
                var insertNonsense=document.getElementById("logTest")
                insertNonsense.innerHTML=finalObj
              }else{
                var finalObj=""
                finalObj += "<ul class='nav navbar-nav navbar-right'>\n"
                finalObj += "<li><a href='#accountModal' role='button' data-toggle='modal'><span class='glyphicon glyphicon-lock'></span> login</a></li>\n"
                finalObj += "<li><a href='#accountModal' role='button' data-toggle='modal'><span class='glyphicon glyphicon-user'></span> sign up</a></li>\n"
                finalObj += "</ul>"
                var insertNonsense=document.getElementById("logTest")
                insertNonsense.innerHTML=finalObj
              }

              if (currentUser) {
                var pStuff = document.getElementById("loginItems");
                    //just commented this to fix an error, you can do whatevs with this
                    //pStuff.innerHTML = "<li style='padding-top:15px;padding-bottom:15px;'><span class=''></span> What's up "+ currentUser.get("username") +"? <li style='cursor:pointer;'><a onclick='logOut()''><span class='glyphicon glyphicon-lock'></span> logout</a>  <li><a href='#''><i class='glyphicon glyphicon-shopping-cart'></i> items in cart: <span style='color:#2A5469'>00</span></a></li>";
                }
                var logOut = function() {
                  Parse.initialize("Ycnw3xJDv5iT8avNOo54rTM0kuTJpNMMwsMs4iIP", "qYnG7XTl8iSLu9M5iP1lZLiC8LBQHYyCvqwuE3e3");
                  Parse.User.logOut();
                var currentUser = Parse.User.current();
              location.reload();
            }
          </script>    
        </div><!-- /login-menu -->

        <!-- Modal -->
        <div id="accountModal" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                <h1 class="text-center blue">welcome!</h1>
              </div>
              <div class="modal-body">
                <div id="modalTabs">
                  <ul id="myTab" class="nav nav-tabs">
                  </ul>
                </div>
                
                <div id="myTabContent" class="tab-content">
                  
                  <!-- SIGN IN -->
                  <div class="tab-pane fade active in" id="signIn">

                      <!--Username input-->
                      <div class="form-group">
                        <div class="input-group">
                          <div class="input-group-addon"></div>
                          <input required="" id="usernameInput" name="usernameInput" type="text" class="form-control input-lg" placeholder="username">
                        </div>
                      </div>

                      <!-- Password input-->
                      <div class="form-group">
                        <div class="input-group">
                          <div class="input-group-addon"><span class="fa fa-key"></span></div>
                          <input required="" id="passwordInput" name="passwordInput" class="form-control input-lg" type="password" placeholder="password">
                        </div>
                        <p id="loginPassError" class="errorAlert"></p>
                      </div>
                                      
                      <!-- Checkbox -->
                      <div class="form-group">                        
                        <div class="checkbox">
                          <label>
                            <input type="checkbox" name="rememberMe" id="rememberMe" value="rememberMe">remember me
                          </label>
                        </div>
                      </div>

                      <!-- Button -->
                      <div class="form-group">
                        <button class="btn btn-primary btn-lg btn-block" onclick="logIn()"><span class="glyphicon glyphicon-ok"></span> log in</button>
                      </div>
                        <script>
                          var logIn = function(){
                            
                            Parse.initialize("Ycnw3xJDv5iT8avNOo54rTM0kuTJpNMMwsMs4iIP", "qYnG7XTl8iSLu9M5iP1lZLiC8LBQHYyCvqwuE3e3");
                            var nameStuff = document.getElementById("usernameInput").value.toLowerCase();
                            var passStuff = document.getElementById("passwordInput").value;

                            Parse.User.logIn(nameStuff, passStuff, {
                              success: function(user) {
                                location.reload();
                              },
                              error: function(user, error) {
                                loginPassError.innerHTML="Your username or password is incorrect"
                                //alert(document.getElementById("loginPassError"))
                              }
                            });
                            event.preventDefault();
                          }
                        </script>                      
                      <p><a href="#">forgot password?</a></p>
                        
                  </div><!-- /signIn -->
                  
                  <!-- SIGN UP -->
                  <div class="tab-pane fade in" id="signUp">
                                            
                      <!-- first input-->
                      <div class="form-group">
                        <input required="" id="fNameInput" name="fNameInput" type="text" class="form-control input-lg" placeholder="first name">
                      </div>
                      
                      <!-- last name input-->
                      <div class="form-group">
                        <input required="" id="lNameInput" name="lNameInput" type="text" class="form-control input-lg" placeholder="last name">
                      </div>
                      
                      <!-- username input-->
                      <div class="form-group">
                        <input required="" id="SUusernameInput" name="usernameInput" type="text" class="form-control input-lg" placeholder="username">
                        <p class="help-block"><em>this is the name that will appear next to your comments, etc.</em></p>
                      </div>

                      <!-- Email input-->
                      <div class="form-group">
                        <div class="input-group">
                          <div class="input-group-addon">@</div>
                          <input required="" id="SUemailInput" name="emailInput" type="text" class="form-control input-lg" placeholder="email">
                        </div>
                      </div>

                      <!-- Password input-->
                      <div class="form-group">
                        <div class="input-group">
                          <div class="input-group-addon"><span class="fa fa-key"></span></div>
                          <input required="" id="SUpasswordInput" name="passwordInput" class="form-control input-lg" type="password" placeholder="password">
                        </div>
                      </div>
                      
                      <!-- check password input-->
                      <div class="form-group">
                        <div class="input-group">
                          <div class="input-group-addon"><span class="fa fa-key"></span></div>
                          <input required="" id="SUpassword2Input" name="password2Input" class="form-control input-lg" type="password" placeholder="re-type password">
                        </div>
                        <p id="woahThere" class="errorAlert"></p>
                      </div>
                      
                      <div>
                        <a href="terms.html">
                          <p>Click here to read terms and conditions</p>
                        </a>
                      </div>

                      <div class="form-group">                        
                        <div class="checkbox">
                          <label>
                            <input type="checkbox" name="terms" id="terms" value="accept" required>I have read and accept the terms and conditions
                          </label>
                        </div>
                      </div>

                      <!-- Button -->
                      <div class="form-group">
                        <button class="btn btn-primary btn-lg btn-block" onclick="signUp();return false;"><span class="glyphicon glyphicon-ok"></span> sign up</button>
                      </div>
                        <script>
                          var signUp = function() {
                            Parse.initialize("Ycnw3xJDv5iT8avNOo54rTM0kuTJpNMMwsMs4iIP", "qYnG7XTl8iSLu9M5iP1lZLiC8LBQHYyCvqwuE3e3");
                            var nameStuff = document.getElementById("SUusernameInput").value.toLowerCase();
                            var passStuff = document.getElementById("SUpasswordInput").value;
                            var passStuff2 = document.getElementById("SUpassword2Input").value;
                            var emailStuff = document.getElementById("SUemailInput").value;
                            var firstStuff = document.getElementById("fNameInput").value;
                            var lastStuff = document.getElementById("lNameInput").value;
                            if (passStuff2 === passStuff) {

                              var user = new Parse.User();
                              user.set("username", nameStuff);
                              user.set("password", passStuff);
                              user.set("email", emailStuff);
                              user.set("firstName", firstStuff);
                              user.set("lastName", lastStuff);
                              user.set("storeId", "")


                              user.signUp(null, {
                                success: function(user) {
                                  alert("Congrats "+nameStuff+", please verify your email");
                                  location.reload();
                                },
                                error: function(user, error) {
                                  alert("Error: " + error.code + " " + error.message);
                                }
                              });
                            }
                            else {
                              woahThere.innerHTML = "Your passwords do not match";
                            }
                          }
                        </script>                        
                  </div><!-- /signUp -->
                  

                  
                  <!-- ACCOUNT SETTINGS -->
                  <div class="tab-pane fade in" id="account">
                    
                      <!-- email change-->
                      <div class="form-group">
                        <label class="form-label" for="emailChange">change your email:</label>
                        <div class="input-group">
                          <div class="input-group-addon">@</div>
                          <input  id="emailChange" name="emailChange" type="text" class="form-control input-lg" placeholder="enter new email">
                        </div>  
                      </div><!-- /form-group -->
                    
                      <!-- password change-->
                      <div class="form-group">
                        <label class="form-label" for="passwordChange">change your password:</label>
                        <div class="input-group">
                          <div class="input-group-addon"><span class="fa fa-key"></span></div>
                          <input  id="passwordChange" name="passwordChange" class="form-control input-lg" type="password" placeholder="enter new password">
                        </div>
                      </div>
                                          
                      <!-- check password input-->
                      <div class="form-group">
                        <div class="input-group">
                          <div class="input-group-addon"><span class="fa fa-key"></span></div>
                          <input  id="changePasswordCheck" name="changePasswordCheck" class="form-control input-lg" type="password" placeholder="re-type new password">
                        </div>
                        <p id="changePasswordAlert" class="errorAlert"></p>
                      </div>
                      
                      <!-- username change-->
                      <div class="form-group">
                        <label class="form-label" for="usernameChange">change your user name:</label>
                        <input  id="usernameChange" name="usernameChange" class="form-control input-lg" type="password" placeholder="enter new user name">
                      </div>
                      
                      <!-- BUTTON -->
                      <div class="form-group">
                        <button class="btn btn-primary btn-lg btn-block" onClick="saveClose()"><span class="glyphicon glyphicon-ok"></span> save and close</button>
                      </div>
                      <script> 
                        var saveClose = function(){
                          Parse.initialize("Ycnw3xJDv5iT8avNOo54rTM0kuTJpNMMwsMs4iIP", "qYnG7XTl8iSLu9M5iP1lZLiC8LBQHYyCvqwuE3e3");
                          //checks if current user is logged in
                          var currentUser = Parse.User.current();
                          var currentName = currentUser.get("username")
                          if(currentName==null||currentName==""){
                            alert("Please log in to continue")
                          }else{
                            if(document.getElementById("emailChange").value!=null&&document.getElementById("emailChange").value!=""){
                                user.set("email", document.getElementById("emailChange"));
                                alert("email changed to " + emailChange);
                            }else{
                            }
                            if(document.getElementById("passwordChange").value!=null&&document.getElementById("passwordChange").value!=""){
                              if(document.getElementById("passwordChange")==document.getElementById("changePasswordCheck")){
                                user.set("password", document.getElementById("passwordChange"))
                              }else{
                                changePasswordAlert.innerHTML="Your passwords do not match"
                              }
                            }
                            if(document.getElementById("usernameChange").value!=null&&document.getElementById("usernameChange".value)!=""){
                              user.set("username", document.getElementById("usernameChange"));
                              alert("username changed to " + usernameChange)
                            }
                          }
                        }
                      </script>
                     <!--<a href="storePreview.html" class="btn btn-lg btn-warning" role="button">edit your store »</a> -->
                  </div><!-- /account -->
                  
                </div><!-- /myTabContent -->
              </div><!-- /modal-body -->
              
              <div class="modal-footer">
                  <button class="btn btn-default" data-dismiss="modal" aria-hidden="true">cancel</button>
              </div>
              
            </div><!-- /modal-content -->
          </div><!-- /modal-dialog -->
        </div><!-- /accountModal -->
        
      </div><!-- /logo row -->
      
      <!-- Static navbar -->
      <div class="navbar navbar-default" role="navigation">
        <div class="container-fluid">
          <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="index.html">home</a>
          </div><!-- /header -->
          
          <div class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
              <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">buy <b class="caret"></b></a>
                <ul class="dropdown-menu">
                  <li><a href="popular.html">popular</a></li>
                  <!-- <li><a href="buy.html">buy page</a></li>
				 <li><a href="store.html">store</a></li> -->
                  <li class="dropdown-submenu"><a href="#">brand</a>
                    <ul class="dropdown-menu">
                      <li><a href="popular.html?brand=adidas">Adidas</a></li>
                      <li><a href="popular.html?brand=airjordan">Air Jordan</a></li>
                      <li><a href="popular.html?brand=asics">Asics</a></li>
                      <li><a href="popular.html?brand=converse">Converse</a></li>
                      <li><a href="popular.html?brand=newbalance">New Balance</a></li>
                      <li><a href="popular.html?brand=nike">Nike</a></li>
                      <li><a href="popular.html?brand=puma">Puma</a></li>
                      <li><a href="popular.html?brand=reebok">Reebok</a></li>
                      <li><a href="popular.html?brand=saucony">Saucony</a></li>
                      <li><a href="popular.html?brand=vans">Vans</a></li>
                    </ul>
                  </li>
                </ul>
              </li>
              <li><a href="sell.html">sell</a></li>
              <li><a target=_blank href="http://heatswap.com/news">news</a>
			 <li><a href="team.html">our team</a></li>
              <li><a href="story.html">a good story</a></li>
              <li><a href="media.html">media</a></li>
            </ul>
            
            <form class="navbar-form navbar-right" role="search">
              <div class="form-group">
                <input id="tempSearch" type="search" class="form-control" placeholder="Search">
              </div>
              <button type="submit" class="btn btn-primary" onclick="submitSearch(); return false;"><span class="glyphicon glyphicon-search"></span></button>
            </form>
            
          </div><!--/.nav-collapse -->
        </div><!--/.container-fluid -->
      </div>

      <div id="main-wrap"><!-- Main content wrapper -->
       <div class="container">
          <div id="cartHeader">

          </div>

          <div class="column-center-cart"> <!-- Middle Column -->
            Items in Cart
            <div id="cartTable">
              Cart Table
            </div>
          </div>

          <div class="column-left-cart"> <!-- Left Column -->
            Recently Viewed
          </div>

          <div class="column-right-cart"> <!-- Right Column -->
            Checkout
          </div>

        </div>
      </div>

      <script>
        if (currentUser != null) //If user signed in
        {
          var currentUsername = document.getElementById("currentUsername").innerHTML;

          Parse.initialize("Ycnw3xJDv5iT8avNOo54rTM0kuTJpNMMwsMs4iIP", "qYnG7XTl8iSLu9M5iP1lZLiC8LBQHYyCvqwuE3e3");
          var Cart = Parse.Object.extend("cart");
          var mailbox = new Parse.Query(Cart);
          var finalObj = "";
          var count = 0;
          finalObj += "<table border='1' style = 'width:100%'>"
          finalObj += "<tr><td>Image</td><td>Item</td><td>Brand</td><td>Price</td><td>Size</td></tr>"
          mailbox.find({
            success: function(items) {

              //Username data
              var Users = Parse.Object.extend("User");
              var user = new Parse.Query(Users);
              user.contains("username", currentUsername); //Find current user's object
              user.find({
                success: function(user) {
                  userFirstName = user[0].get("firstName");
                  userLastName = user[0].get("lastName");
                  document.getElementById("pageTitle").innerHTML = userFirstName + " " + userLastName + "'s Cart (" + items.length + ")";
                  document.getElementById("cartHeader").innerHTML = "<h2>Hello, " + userFirstName + "</h2>";
                },
                error: function(error) {
                  alert("Could not find current user, with error code: " + error.message);
                }
              })

              //Cart data
              for (var i = 0; i < items.length; i++)
              {
                var Shoe = Parse.Object.extend("shoe");
                var shoe = new Parse.Query(Shoe);
                shoe.contains("objectId", items[i].get("itemID")); //Find item within its class
                shoe.find({
                  success: function(shoes) {
                    finalObj += "<tr>";
                    finalObj += "<td>" + "<div style='width:250px; height:200px; overflow:hidden; text-align: center;'>\n"
                    finalObj += "<img src='" + lowResImageLandscape(shoes[0].get("image")) + "' style='position:relative; left:100%; margin-left:-200%;' height='200'>\n";
                    finalObj += "</div>" + "</td>"; //Image
                    finalObj += "<td>" + shoes[0].get("item") + "</td>"; //Item name
                    finalObj += "<td>" + shoes[0].get("brand") + "</td>"; //Brand
                    finalObj += "<td>" + shoes[0].get("price") + "</td>"; //Price
                    finalObj += "<td>" + shoes[0].get("size") + "</td>"; //Size
                    finalObj += "</tr>";
                    count++; //Add to counter
                    if (i >= items.length & count >= items.length) //If done
                    {
                      // alert(finalObj)
                      finalObj += "</table>";
                      document.getElementById("cartTable").innerHTML = finalObj;
                    }
                  },
                  error: function(error) {
                    alert("Could not find shoe, with error code: " + error.message);
                  }
                })
              }
            },
            error: function(error) {
              alert('Failed to find items in cart, with error code: ' + error.message);
            }
          });
        }
        else //If no user signed in
        {
          document.getElementById("cartHeader") = "<h3>Please sign in to view your cart</h3>";
        }
      </script>


    <!-- Bootstrap core JavaScript
    ================================================== -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    
  </body>
</html>
